# 比赛列表功能实现说明

## 功能概述

本次更新实现了手机侧的比赛列表展示和选择功能，以及倒计时按钮的优化。

## 主要功能

### 1. 比赛列表展示和选择

#### 功能描述
- 手机侧可以获取PC侧已存在的比赛列表
- 用户可以从下拉列表中选择具体的比赛
- 选择比赛后，PC侧和手机侧会同步更新各小节比赛比分和总比分

#### 实现细节
- 在`MainActivity`中添加了`availableMatches`列表来存储可选择的比赛
- 实现了`showSelectExistingMatchDialog()`方法来显示比赛选择对话框
- 实现了`selectExistingMatch()`方法来处理比赛选择逻辑
- 在`BluetoothManager`中添加了比赛信息解析和处理逻辑

#### 使用方法
1. 点击"选择比赛"按钮
2. 系统会自动从PC侧获取比赛列表
3. 在弹出的对话框中选择要进行的比赛
4. 选择后，比分和节次信息会自动同步

### 2. 倒计时按钮优化

#### 功能描述
- 倒计时按钮更大，更易操作
- 暂停计时时，PC侧会停在时间页面
- 添加了倒计时状态管理

#### 实现细节
- 在布局文件中优化了倒计时按钮的大小和排列
- 在`MainActivity`中添加了`isTimerRunning`和`isTimerPaused`状态变量
- 实现了倒计时按钮的状态管理，确保按钮状态与计时状态一致
- 在`BluetoothManager`中优化了倒计时命令的发送格式

#### 按钮状态说明
- **开始计时**: 初始状态可用，点击后变为不可用
- **暂停计时**: 计时开始后可用，点击后变为不可用
- **继续倒计时**: 暂停后可用，点击后变为不可用

### 3. 比分同步机制

#### 功能描述
- 选择比赛后，手机侧和PC侧的比分会自动同步
- 实时更新当前节次比分和总比分
- 支持节次切换时的比分保存和更新

#### 实现细节
- 在`updateMatchInfo()`方法中实现了比分的实时计算和显示
- 在`nextQuarter()`方法中添加了比分同步逻辑
- 在`createNewMatch()`和`selectExistingMatch()`方法中实现了初始比分同步

## 技术实现

### 数据流程
1. 手机侧发送`GET_ALL_MATCHES`命令到PC侧
2. PC侧返回比赛信息列表（`MATCH_INFO:id|name|note|homeScore|awayScore|createdAt`）
3. 手机侧解析比赛信息并显示选择对话框
4. 用户选择比赛后，发送`SELECT_MATCH:id`命令
5. PC侧确认选择并同步比分信息

### 命令格式
- `GET_ALL_MATCHES`: 获取所有比赛列表
- `SELECT_MATCH:id`: 选择指定ID的比赛
- `START_TIMER`: 开始倒计时
- `PAUSE_TIMER`: 暂停倒计时
- `CONTINUE_TIMER`: 继续倒计时

### 响应处理
- `MATCH_INFO:id|name|note|homeScore|awayScore|createdAt`: 比赛信息
- `MATCH_LIST_END`: 比赛列表接收完成
- `NO_MATCHES_FOUND`: 没有找到比赛
- `MATCH_SELECTED`: 比赛选择成功
- `SCORE_SYNCED`: 比分同步成功

## 测试验证

### 测试文件
- `TestMatchList.java`: 测试比赛列表功能
- `test_match_list.bat`: 运行测试的批处理脚本

### 测试步骤
1. 运行`test_match_list.bat`
2. 验证比赛列表的创建和显示
3. 验证比赛选择功能
4. 验证比分更新逻辑

## 注意事项

1. **蓝牙连接**: 确保手机侧与PC侧已建立蓝牙连接
2. **权限设置**: 确保应用有蓝牙相关权限
3. **数据同步**: 选择比赛后，比分会自动同步，无需手动操作
4. **状态管理**: 倒计时按钮状态会根据当前计时状态自动更新

## 后续优化建议

1. **缓存机制**: 可以添加比赛列表的本地缓存，提高加载速度
2. **搜索功能**: 可以添加比赛名称的搜索功能
3. **排序功能**: 可以按时间、比分等条件对比赛进行排序
4. **离线支持**: 可以添加离线模式下的比赛管理功能 