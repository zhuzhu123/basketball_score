# 蓝牙网络连接使用说明

## 🔗 连接方式

系统使用**网络Socket连接**来模拟蓝牙通信，实现手机端和PC端的数据传输。

## 📱 手机端配置

### 1. 网络权限
确保Android应用已添加网络权限：

```xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
```

### 2. 连接PC
1. 点击"连接PC"按钮
2. 输入PC的IP地址（如：192.168.1.100）
3. 点击"连接"
4. 等待连接成功提示

### 3. 发送命令
连接成功后，所有操作会自动发送到PC端：
- 新建比赛 → `NEW_MATCH:比赛名称|备注`
- 龙都F4得分 → `HOME_SCORE:分数`
- 暴风队得分 → `AWAY_SCORE:分数`
- 保存节次 → `SAVE_QUARTER:节次|龙都F4分|暴风队分`
- 保存比赛 → `SAVE_MATCH:比赛名称|龙都F4总分|暴风队总分`
- 倒计时 → `START_COUNTDOWN`、`STOP_COUNTDOWN`

## 💻 PC端配置

### 1. 数据库设置
确保MySQL数据库已启动：
- **数据库名**：ba_score
- **用户名**：root
- **密码**：123456
- **端口**：3306

### 2. 启动服务
1. 运行`BasketballFullScreenDisplay`
2. 系统自动启动网络服务器（端口8888）
3. 等待手机端连接

### 3. 数据处理
PC端会自动处理手机发送的命令：
- 新建比赛 → 创建数据库记录
- 得分命令 → 更新界面显示
- 保存命令 → 存储到数据库
- 倒计时 → 启动倒计时和语音播报

## 🌐 网络配置

### 1. 获取PC IP地址
在PC端打开命令提示符，输入：
```cmd
ipconfig
```
查找"IPv4地址"，如：192.168.1.100

### 2. 防火墙设置
确保Windows防火墙允许Java应用访问网络：
1. 打开"Windows Defender防火墙"
2. 点击"允许应用或功能通过Windows Defender防火墙"
3. 找到Java程序，确保勾选"专用"和"公用"

### 3. 端口配置
- **PC端监听端口**：8888
- **协议**：TCP
- 确保端口未被其他程序占用

## 🧪 测试连接

### 1. 使用测试客户端
```bash
# 编译测试客户端
javac TestNetworkClient.java

# 运行测试
java TestNetworkClient
```

### 2. 测试流程
1. 启动PC端程序
2. 运行测试客户端
3. 观察连接状态和命令响应
4. 检查数据库记录

### 3. 预期结果
```
正在连接到PC端服务器...
连接成功！开始发送测试命令...

1. 测试新建比赛
PC响应: MATCH_CREATED:1

2. 测试龙都F4得分
PC响应: ACK

3. 测试暴风队得分
PC响应: ACK

4. 测试保存节次
PC响应: QUARTER_SAVED

5. 测试倒计时
PC响应: ACK

6. 测试保存比赛
PC响应: MATCH_SAVED

测试完成！
```

## 🔧 故障排除

### 1. 连接失败
**问题**：手机无法连接到PC
**解决方案**：
- 检查PC和手机是否在同一网络
- 确认PC的IP地址是否正确
- 检查防火墙设置
- 确保PC端程序已启动

### 2. 数据库错误
**问题**：PC端数据库连接失败
**解决方案**：
- 启动MySQL服务
- 检查数据库连接参数
- 确认数据库用户权限
- 查看控制台错误信息

### 3. 命令无响应
**问题**：手机发送命令后无响应
**解决方案**：
- 检查网络连接状态
- 查看PC端控制台日志
- 确认命令格式正确
- 重启连接

### 4. 界面不更新
**问题**：PC端界面不显示最新数据
**解决方案**：
- 检查UI更新线程
- 确认数据库写入成功
- 重启PC端程序

## 📋 命令协议

### 手机端 → PC端命令
| 命令 | 格式 | 说明 | PC响应 |
|------|------|------|--------|
| 新建比赛 | `NEW_MATCH:名称|备注` | 创建新比赛 | `MATCH_CREATED:ID` |
| 龙都F4得分 | `HOME_SCORE:分数` | 龙都F4加分 | `ACK` |
| 暴风队得分 | `AWAY_SCORE:分数` | 暴风队加分 | `ACK` |
| 保存节次 | `SAVE_QUARTER:节次|龙都F4分|暴风队分` | 保存节次比分 | `QUARTER_SAVED` |
| 保存比赛 | `SAVE_MATCH:名称|龙都F4总分|暴风队总分` | 保存比赛总分 | `MATCH_SAVED` |
| 开始倒计时 | `START_COUNTDOWN` | 开始15秒倒计时 | `ACK` |
| 停止倒计时 | `STOP_COUNTDOWN` | 停止倒计时 | `ACK` |
| 重置比分 | `RESET_SCORE` | 重置所有比分 | `ACK` |

### PC端响应码
| 响应 | 说明 |
|------|------|
| `ACK` | 命令已收到并处理 |
| `MATCH_CREATED:ID` | 比赛创建成功，返回比赛ID |
| `QUARTER_SAVED` | 节次比分保存成功 |
| `MATCH_SAVED` | 比赛总分保存成功 |
| `ERROR:消息` | 处理命令时发生错误 |

## 🚀 使用步骤

### 1. 环境准备
1. 确保PC和手机在同一局域网
2. 启动MySQL数据库服务
3. 获取PC的IP地址

### 2. 启动程序
1. **PC端**：运行`BasketballFullScreenDisplay`
2. **手机端**：启动Android应用

### 3. 建立连接
1. 在手机端点击"连接PC"
2. 输入PC的IP地址
3. 点击连接，等待成功提示

### 4. 开始比赛
1. 点击"新建比赛"，输入比赛信息
2. 使用加分按钮记录得分
3. PC端实时显示比分和语音播报
4. 系统自动保存比赛数据

### 5. 比赛结束
1. 点击"保存比赛"保存总分
2. 查看数据库中的比赛记录
3. 断开连接

---

**注意**：首次使用时，请先运行测试客户端验证连接是否正常，确保网络配置正确后再使用手机端应用。 